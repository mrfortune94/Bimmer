name: Rebuild APK

on:
  push:
    branches:
      - automate-rebuild-apk

jobs:
  build-apk:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up APKTool
      run: |
        wget https://github.com/iBotPeaches/Apktool/releases/download/v2.7.0/apktool_2.7.0.jar -O apktool.jar
        echo "java -jar apktool.jar \"$@\"" > apktool
        chmod +x apktool
        sudo mv apktool /usr/local/bin/

    - name: Extract decompiled APK zip
      run: |
        mkdir -p decompiled_apk
        unzip decompiled_apk.zip -d decompiled_apk

    - name: Rebuild APK using APKTool
      run: |
        apktool b decompiled_apk -o rebuilt_apk.apk

    - name: Upload Rebuilt APK
      uses: actions/upload-artifact@v3
      with:
        name: Rebuilt-APK
        path: rebuilt_apk.apk
